<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Bithumb Market Trading</title>

<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
    padding: 18px;
    margin: 0;
    background: #f6f6f6;
  }
  h2 { font-size: 20px; margin-top: 20px; color: #333; }
  .card {
    background: white;
    padding: 16px;
    border-radius: 14px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    margin-bottom: 25px;
  }
  input, select {
    width: 100%;
    padding: 14px;
    border-radius: 12px;
    border: 1px solid #ddd;
    margin-bottom: 12px;
    font-size: 16px;
  }
  button {
    width: 100%;
    padding: 14px;
    font-size: 17px;
    background: #ff6b00;
    color: white;
    border: none;
    border-radius: 12px;
  }
  button:active { opacity: 0.7; }
  pre {
    padding: 16px;
    background: #1e1e1e;
    color: #00ff9b;
    border-radius: 10px;
    white-space: pre-wrap;
    font-size: 13px;
  }
</style>
</head>
<body>

<h1 style="font-size:24px;">ğŸ“± Bithumb ì‹œì¥ê°€ ë§¤ìˆ˜/ë§¤ë„</h1>

<div class="card">
  <h2>ğŸ” API ì„¤ì •</h2>
  <input id="apiKey" placeholder="API Key ì…ë ¥">
  <input id="apiSecret" placeholder="API Secret ì…ë ¥">
</div>

<div class="card">
  <h2>ğŸª™ ì½”ì¸ ì„ íƒ</h2>
  <select id="orderCurrency">
    <option value="BTC">BTC</option>
    <option value="ETH">ETH</option>
    <option value="SOL">SOL</option>
  </select>
</div>

<div class="card">
  <h2>ğŸ“ˆ ì‹œì¥ê°€ ë§¤ìˆ˜</h2>
  <input id="buyUnits" placeholder="ë§¤ìˆ˜ ì½”ì¸ ìˆ˜ëŸ‰ (ì˜ˆ: 0.02)">
  <button onclick="marketBuy()">ì‹œì¥ê°€ ë§¤ìˆ˜ ì‹¤í–‰</button>
  <pre id="buyResult"></pre>
</div>

<div class="card">
  <h2>ğŸ“‰ ì‹œì¥ê°€ ë§¤ë„</h2>
  <input id="sellUnits" placeholder="ë§¤ë„ ì½”ì¸ ìˆ˜ëŸ‰ (ì˜ˆ: 0.02)">
  <button onclick="marketSell()">ì‹œì¥ê°€ ë§¤ë„ ì‹¤í–‰</button>
  <pre id="sellResult"></pre>
</div>

<script>
// ------------------------------------------------
// ê³µìš© ìœ í‹¸ í•¨ìˆ˜ë“¤
// ------------------------------------------------
function urlencode(params) {
  return Object.entries(params)
    .map(([k, v]) => encodeURIComponent(k) + "=" + encodeURIComponent(v))
    .join("&");
}

async function hmacSHA512(secret, message) {
  const key = await crypto.subtle.importKey(
    "raw",
    new TextEncoder().encode(secret),
    { name: "HMAC", hash: "SHA-512" },
    false,
    ["sign"]
  );

  const signature = await crypto.subtle.sign(
    "HMAC",
    key,
    new TextEncoder().encode(message)
  );

  return Array.from(new Uint8Array(signature))
    .map(b => b.toString(16).padStart(2, "0"))
    .join("");
}

// ------------------------------------------------
// API ìš”ì²­ í•¨ìˆ˜ â€” ì—ëŸ¬ë¥¼ alertë¡œ í‘œì‹œí•˜ë„ë¡ ìˆ˜ì •
// ------------------------------------------------
async function callBithumb(endpoint, params) {
  try {
    const apiKey = document.getElementById("apiKey").value.trim();
    const apiSecret = document.getElementById("apiSecret").value.trim();

    if (!apiKey || !apiSecret) {
      alert("API Key / Secretì„ ì…ë ¥í•˜ì„¸ìš”.");
      return null;
    }

    const nonce = Date.now().toString();
    const query = urlencode(params);
    const data = `${endpoint}\u0000${query}\u0000${nonce}`;

    const hex = await hmacSHA512(apiSecret, data);
    const apiSign = btoa(hex);

    const res = await fetch("https://api.bithumb.com" + endpoint, {
      method: "POST",
      headers: {
        "Api-Key": apiKey,
        "Api-Nonce": nonce,
        "Api-Sign": apiSign,
        "Content-Type": "application/x-www-form-urlencoded",
        Accept: "application/json"
      },
      body: query
    });

    if (!res.ok) {
      alert("HTTP ì˜¤ë¥˜: " + res.status + " / " + res.statusText);
      return null;
    }

    const json = await res.json();

    // ë¹—ì¸ API ì˜¤ë¥˜ ì²˜ë¦¬
    if (json.status !== "0000") {
      alert("ë¹—ì¸ ì˜¤ë¥˜: " + json.status + "\n" + JSON.stringify(json));
      return null;
    }

    return json;

  } catch (e) {
    alert("ì˜ˆì™¸ ë°œìƒ: " + e.message);
    return null;
  }
}

// ------------------------------------------------
// ì‹œì¥ê°€ ë§¤ìˆ˜
// ------------------------------------------------
async function marketBuy() {
  const coin = document.getElementById("orderCurrency").value;
  const units = document.getElementById("buyUnits").value.trim();

  if (!units) {
    alert("ë§¤ìˆ˜í•  ì½”ì¸ ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  const result = await callBithumb("/trade/market_buy", {
    units,
    order_currency: coin,
    payment_currency: "KRW"
  });

  if (result) {
    document.getElementById("buyResult").textContent =
      JSON.stringify(result, null, 2);
  }
}

// ------------------------------------------------
// ì‹œì¥ê°€ ë§¤ë„
// ------------------------------------------------
async function marketSell() {
  const coin = document.getElementById("orderCurrency").value;
  const units = document.getElementById("sellUnits").value.trim();

  if (!units) {
    alert("ë§¤ë„í•  ì½”ì¸ ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  const result = await callBithumb("/trade/market_sell", {
    units,
    order_currency: coin,
    payment_currency: "KRW"
  });

  if (result) {
    document.getElementById("sellResult").textContent =
      JSON.stringify(result, null, 2);
  }
}

</script>

</body>
</html>
